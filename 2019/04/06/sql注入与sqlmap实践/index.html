<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-simple.min.css?v=1.0.2">





  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">



















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"always","offset":10,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="0x01 前言很多人会思考个概念使用工具去入侵机器？脚本小子？不，使用工具是对技术和开发者项工具的人的尊重，而脚本小子是并不知道什么原理就去拿工具去扫描。sqlmap——-&amp;gt;官方网站是由python编写的开源自动化sql检测和利用工具。本文章是sqlmap使用总结和知识回顾 工作模式sql执行操作后：  1、判断可注入的参数2、判断可以用那种SQL注入技术来注入3、识别出哪种数据库4、根据用">
<meta name="keywords" content="sqlmap">
<meta property="og:type" content="article">
<meta property="og:title" content="sqlmap使用手册">
<meta property="og:url" content="blog.manhao6.cn/2019/04/06/sql注入与sqlmap实践/index.html">
<meta property="og:site_name" content="m&#39;bolg">
<meta property="og:description" content="0x01 前言很多人会思考个概念使用工具去入侵机器？脚本小子？不，使用工具是对技术和开发者项工具的人的尊重，而脚本小子是并不知道什么原理就去拿工具去扫描。sqlmap——-&amp;gt;官方网站是由python编写的开源自动化sql检测和利用工具。本文章是sqlmap使用总结和知识回顾 工作模式sql执行操作后：  1、判断可注入的参数2、判断可以用那种SQL注入技术来注入3、识别出哪种数据库4、根据用">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418042800199.png">
<meta property="og:image" content="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043044906.png">
<meta property="og:image" content="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043222137.png">
<meta property="og:image" content="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043600565.png">
<meta property="og:updated_time" content="2019-05-24T18:00:01.531Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sqlmap使用手册">
<meta name="twitter:description" content="0x01 前言很多人会思考个概念使用工具去入侵机器？脚本小子？不，使用工具是对技术和开发者项工具的人的尊重，而脚本小子是并不知道什么原理就去拿工具去扫描。sqlmap——-&amp;gt;官方网站是由python编写的开源自动化sql检测和利用工具。本文章是sqlmap使用总结和知识回顾 工作模式sql执行操作后：  1、判断可注入的参数2、判断可以用那种SQL注入技术来注入3、识别出哪种数据库4、根据用">
<meta name="twitter:image" content="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418042800199.png">



  <link rel="alternate" href="/atom.xml" title="m'bolg" type="application/atom+xml">




  <link rel="canonical" href="blog.manhao6.cn/2019/04/06/sql注入与sqlmap实践/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>sqlmap使用手册 | m'bolg</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">m'bolg</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">做安全的渣渣辉</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">

    
    
    
      
    

    

    <a href="/标签/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-类别">

    
    
    
      
    

    

    <a href="/分类/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>类别</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-关于我">

    
    
    
      
    

    

    <a href="/关于我/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-档案">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>档案</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.manhao6.cn/2019/04/06/sql注入与sqlmap实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tea_Mh">
      <meta itemprop="description" content="兜兜的熊猫">
      <meta itemprop="image" content="https://upload-images.jianshu.io/upload_images/8707100-c1b6a69a8bfcd8c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/957/format/webp">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="m'bolg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">sqlmap使用手册

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-06 16:43:32" itemprop="dateCreated datePublished" datetime="2019-04-06T16:43:32+08:00">2019-04-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-25 02:00:01" itemprop="dateModified" datetime="2019-05-25T02:00:01+08:00">2019-05-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/0x01-应用实践/" itemprop="url" rel="index"><span itemprop="name">0x01 应用实践</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/0x01-应用实践/工具手册/" itemprop="url" rel="index"><span itemprop="name">工具手册</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>很多人会思考个概念使用工具去入侵机器？脚本小子？不，使用工具是对技术和开发者项工具的人的尊重，而脚本小子是并不知道什么原理就去拿工具去扫描。<br>sqlmap——-&gt;<a href="http://sqlmap.org/" target="_blank" rel="noopener">官方网站</a><br>是由python编写的开源自动化sql检测和利用工具。本文章是sqlmap使用总结和知识回顾</p>
<h2 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h2><p>sql执行操作后：</p>
<blockquote>
<p>1、判断可注入的参数<br>2、判断可以用那种SQL注入技术来注入<br>3、识别出哪种数据库<br>4、根据用户选择，做相应的操作</p>
</blockquote>
<a id="more"></a>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB 等数据库均支持</li>
<li><p>支持五种不同的注入模式：</p>
<blockquote>
<p>1、基于布尔的盲注，即可以根据返回页面判断条件真假的注入。<br>2、基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。<br>3、基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。<br>4、联合查询注入，可以使用union的情况下的注入。<br>5、堆查询注入，可以同时执行多条语句的执行时的注入</p>
</blockquote>
</li>
<li><p>支持枚举用户、密码、哈希、权限、角色、数据库、数据表和列</p>
</li>
<li>支持脱库操作（用户可自行选择）</li>
<li>支持上传下载文件和命令执行（mysql，postgresql，sql server）</li>
</ul>
<h1 id="sqlmap使用"><a href="#sqlmap使用" class="headerlink" title="sqlmap使用"></a>sqlmap使用</h1><p>sql执行包括</p>
<ul>
<li>Target（目标）</li>
<li>Request（请求）</li>
<li>Optimization（优化）</li>
<li>Injection（注入）</li>
<li>Detection（检测）</li>
<li>Techniques（技巧）</li>
<li>Fingerprint（指纹）</li>
<li>Enumeration（枚举）</li>
<li>Brute force（暴力破解）</li>
<li>User-defined function injection（用户自定义函数注入）</li>
<li>File system access（访问文件系统）</li>
<li>Operating system access（操作系统访问）</li>
<li>Windows注册表访问</li>
<li>General（一般）和杂项：</li>
</ul>
<h2 id="Target（目标）"><a href="#Target（目标）" class="headerlink" title="Target（目标）"></a>Target（目标）</h2><h3 id="参数：-–url-u"><a href="#参数：-–url-u" class="headerlink" title="参数： –url -u"></a>参数： –url -u</h3><p>格式：http(s)://targeturl[:port]/[…]<br>例如：python sqlmap.py -u”<a href="http://www.baidu.com/?id=1&quot;" target="_blank" rel="noopener">http://www.baidu.com/?id=1&quot;</a> </p>
<h3 id="参数：-m-l"><a href="#参数：-m-l" class="headerlink" title="参数： -m -l"></a>参数： -m -l</h3><p>-m获取多个扫描目标，sqlmap会一个个检测。<br>文件格式如：</p>
<blockquote>
<p><a href="http://www.baidu.com?id=1" target="_blank" rel="noopener">www.baidu.com?id=1</a><br><a href="http://www.sougou.com?id=2" target="_blank" rel="noopener">www.sougou.com?id=2</a><br><a href="http://www.xx.com?id=3、" target="_blank" rel="noopener">www.xx.com?id=3、</a></p>
</blockquote>
<p>-l从Burp或WebScarab代理的日志中解析目标（包括post，cookie）</p>
<h3 id="参数：-d"><a href="#参数：-d" class="headerlink" title="参数：-d"></a>参数：-d</h3><p>直接连接数据库<br>使用参数“-d”直接连接数据库，该参数后跟一个表示数据库的字符串，该字符串有以下两种格式：</p>
<p>(1).当数据库管理系统是MySQL、Oracle、Microsoft SQL Server或PostgreSQL等时格式为：</p>
<blockquote>
<p>DBMS://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_NAME</p>
</blockquote>
<p>(2).当数据库管理系统是SQLite、Microsoft Access或Firebird等时格式为：</p>
<blockquote>
<p>DBMS://DATABASE_FILEPATH</p>
</blockquote>
<p>我用如下命令连接装在本机上的Mysql：</p>
<blockquote>
<p>python sqlmap.py -d “mysql://root:<a href="mailto:root@127.0.0.1" target="_blank" rel="noopener">root@127.0.0.1</a>:3306/DISSchool”</p>
</blockquote>
<p>却出现了错误，错误为：</p>
<blockquote>
<p> [CRITICAL] sqlmap requires ‘python-pymysql’ third-party library in order to directly connect to the DBMS ‘MySQL’. You can download it from ‘<a href="https://github.com/petehunt/PyMySQL/&#39;" target="_blank" rel="noopener">https://github.com/petehunt/PyMySQL/&#39;</a>. Alternative is to use a package ‘python-sqlalchemy’ with support for dialect ‘mysql’ installed</p>
</blockquote>
<p>意思是我没有安装Python连接Mysql用的第三方库python-pymysql。虽然我安装了python-mysqldb可以使Python连接Mysql，但显然Sqlmap使用的是python-pymysql而不是python-mysqldb。使用如下命令安装python-pymysql：</p>
<blockquote>
<p> git clone <a href="https://github.com/petehunt/PyMySQL/" target="_blank" rel="noopener">https://github.com/petehunt/PyMySQL/</a><br>  cd PyMySQL/<br>  sudo python setup.py install</p>
</blockquote>
<p>安装好python-pymysql后再执行命令：</p>
<blockquote>
<p>python sqlmap.py -d “mysql://root:<a href="mailto:root@127.0.0.1" target="_blank" rel="noopener">root@127.0.0.1</a>:3306/DISSchool”</p>
</blockquote>
<p>这次没有报错，成功的连接到了数据库。只是除了检测数据库确实是Mysql版本号大于等于5.0.0之外便什么都没有做。让Sqlmap做点什么需要用其他参数指定，这些参数我们稍晚些再学习。</p>
<h3 id="参数：-r"><a href="#参数：-r" class="headerlink" title="参数： -r"></a>参数： -r</h3><p>sqlmap可以从文本获取http请求头。有的请求需要加载cookie，post数据，有些waf，阿里云会根据sql请求头（User-agent: sqlmap/1.3#stable (<a href="http://sqlmap.org)）而封ip，这样加载可以通过一些检测和跳过设置cookie" target="_blank" rel="noopener">http://sqlmap.org)）而封ip，这样加载可以通过一些检测和跳过设置cookie</a><br>如：</p>
<blockquote>
<p>POST /vuln.php HTTP/1.1<br>Host: <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a><br>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0<br>Cookie:BAIDUID=2FF9C5F75287AE0C94B0E3E9C8FE<br>id=1</p>
</blockquote>
<h3 id="参数：-g"><a href="#参数：-g" class="headerlink" title="参数：-g"></a>参数：-g</h3><p>-g 处理Google的结果作为目标URL</p>
<blockquote>
<p>python sqlmap.py -g “inurl:\”.php?id=1\””</p>
</blockquote>
<h3 id="参数：-c"><a href="#参数：-c" class="headerlink" title="参数：-c"></a>参数：-c</h3><p>CONFIGFILE 从配置文件中加载选项,需指定文件如sqlmap.conf，sqlmap会自动解析该配置文件，按照配置文件配置执行动作，除了指定攻击目标还支持，指定对应目标的各种参数(格式如安装目录中有一个名为 sqlmap.conf 的文件)</p>
<h2 id="Request（请求）"><a href="#Request（请求）" class="headerlink" title="Request（请求）"></a>Request（请求）</h2><p>在http请求阶段，往往在不同网站不同位置要求携带不同参数（refer，user-agent，cookie，post），只有携带要求的参数才能发起合法的请求。所以我们要根据目标网站需要而设定请求细节。</p>
<h3 id="参数：–data-–param-del"><a href="#参数：–data-–param-del" class="headerlink" title="参数：–data,–param-del"></a>参数：–data,–param-del</h3><p>此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</p>
<blockquote>
<p>python sqlmap.py -u “<a href="http://www.baidu.com/1.php&quot;" target="_blank" rel="noopener">http://www.baidu.com/1.php&quot;</a> –data=”id=1”</p>
</blockquote>
<p>–param-del当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数。</p>
<blockquote>
<p>python sqlmap.py -u “<a href="http://www.baidu.com/1.php&quot;" target="_blank" rel="noopener">http://www.baidu.com/1.php&quot;</a> –data=”query=x;id=1” –param-del=”;”</p>
</blockquote>
<h3 id="参数：–cookie-–load-cookies-–drop-set-cookie-–cookie-del"><a href="#参数：–cookie-–load-cookies-–drop-set-cookie-–cookie-del" class="headerlink" title="参数：–cookie,–load-cookies,–drop-set-cookie –cookie-del"></a>参数：–cookie,–load-cookies,–drop-set-cookie –cookie-del</h3><p>有两种情况需要cookie：</p>
<ul>
<li>注入的界面需要登录才能获取</li>
<li>cookie是否存在注入</li>
</ul>
<p>可以通过抓包把cookie获取到，复制出来，然后加到–cookie参数里。<br>load-cookie从文件读取cookie<br>如果你不想接受Set-Cookie可以使用–drop-set-cookie参数来拒接。<br>当你使用–cookie参数时，当返回一个Set-Cookie头的时候，sqlmap会询问你用哪个cookie来继续接下来的请求。当–level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数<br>post参数默认分隔符；，指定分隔符–cookie-del </p>
<blockquote>
<p>python sqlmap.py -u “<a href="http://www.baidu.com/user.php&quot;" target="_blank" rel="noopener">http://www.baidu.com/user.php&quot;</a> --cookie “JSESSIONID=E5D6C8C81;NAME=werner;”</p>
</blockquote>
<h3 id="参数：–user-agent-–random-agent"><a href="#参数：–user-agent-–random-agent" class="headerlink" title="参数：–user-agent,–random-agent"></a>参数：–user-agent,–random-agent</h3><p>默认sqlmap请求头为如下，这种可能会被waf检测直接封ip</p>
<blockquote>
<p>User-agent: sqlmap/1.3#stable</p>
</blockquote>
<p>–user-agent用户指定请求头<br>–random-agnet参数来随机的从./txt/user-agents.txt中获取<br>当–level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。</p>
<h3 id="参数：–referer"><a href="#参数：–referer" class="headerlink" title="参数：–referer"></a>参数：–referer</h3><p>sqlmap可以在请求中伪造HTTP中的referer，当–level参数设定为3或者3以上的时候会尝试对referer注入</p>
<h3 id="参数：–headers"><a href="#参数：–headers" class="headerlink" title="参数：–headers"></a>参数：–headers</h3><p>可以通过–headers参数来增加额外的http头</p>
<h3 id="参数：–delay"><a href="#参数：–delay" class="headerlink" title="参数：–delay"></a>参数：–delay</h3><p>过于频繁地发送请求可能会被网站察觉或其他后果,严重者可能服务器崩溃。<br>使用参数“–delay”来指定 HTTP 请求之间的延迟，单位为秒，类型是浮点数，如“–delay 1.5”表示延迟 1.5 秒。默认是没有延迟的</p>
<h3 id="参数：–timeout"><a href="#参数：–timeout" class="headerlink" title="参数：–timeout"></a>参数：–timeout</h3><p>可以设定一个HTTP(S)请求超过多久判定为超时，10.5表示10.5秒，默认是30秒</p>
<h3 id="参数：–retries"><a href="#参数：–retries" class="headerlink" title="参数：–retries"></a>参数：–retries</h3><p>当HTTP(S)超时时，可以设定重新尝试连接次数，默认是3次</p>
<h3 id="参数：–randomize"><a href="#参数：–randomize" class="headerlink" title="参数：–randomize"></a>参数：–randomize</h3><p>可以设定某一个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样</p>
<h3 id="参数：–safe-url-–safe-post-–safe-freq-–safe-feq"><a href="#参数：–safe-url-–safe-post-–safe-freq-–safe-feq" class="headerlink" title="参数：–safe-url,–safe-post –safe-freq –safe-feq"></a>参数：–safe-url,–safe-post –safe-freq –safe-feq</h3><p>有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行</p>
<blockquote>
<p>1、–safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。<br>2、–safe-post: 访问安全 URL 时携带的 POST 数据<br>3、–safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。<br>4、–safe-req: 从文件中载入安全 HTTP 请求</p>
</blockquote>
<h3 id="参数：–skip-urlencode"><a href="#参数：–skip-urlencode" class="headerlink" title="参数：–skip-urlencode"></a>参数：–skip-urlencode</h3><p>根据参数位置，他的值默认将会被URL编码，但是有些时候后端的web服务器不遵守RFC标准，只接受不经过URL编码的值，这时候就需要用–skip-urlencode参数</p>
<h3 id="参数：–csrf-token-和–csrf-url"><a href="#参数：–csrf-token-和–csrf-url" class="headerlink" title="参数：–csrf-token 和–csrf-url"></a>参数：–csrf-token 和–csrf-url</h3><p>现在有很多网站通过在表单中添加值为随机生成的 token 的隐藏字段来防止 CSRF 攻击，Sqlmap 会自动识别出这种保护方式并绕过。但自动识别有可能失效，此时就要用到这两个参数。</p>
<ul>
<li>–csrf-token   用于指定包含 token 的隐藏字段名，若这个字段名不是常见的防止 CSRF 攻击的字段名 Sqlmap 可能不能自动识别出，需要手动指定。如 Django 中该字段名为“csrfmiddlewaretoken”，明显与 CSRF 攻击有关。</li>
<li>–csrf-url   用于从任意的 URL 中回收 token 值。若最初有漏洞的目标 URL 中没有包含 token 值而又要求在其他地址提取 token 值时该参数就很有用</li>
</ul>
<h3 id="参数：–eval"><a href="#参数：–eval" class="headerlink" title="参数：–eval"></a>参数：–eval</h3><p>有些时候，需要根据某个参数的变化，而修改另个一参数，才能形成正常的请求，这时可以用–eval参数在每次请求时根据所写python代码做完修改后请求</p>
<blockquote>
<p>python sqlmap.py -u”<a href="http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot;" target="_blank" rel="noopener">http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot;</a> –eval=”import hashlib;hash=hashlib.md5(id).hexdigest()”</p>
</blockquote>
<p>请求就是每次请求时根据id参数值，做一次md5后作为hash参数的值</p>
<h3 id="参数：–auth-type-–auth-cred"><a href="#参数：–auth-type-–auth-cred" class="headerlink" title="参数：–auth-type,–auth-cred"></a>参数：–auth-type,–auth-cred</h3><p>这些参数可以用来登陆HTTP的认证保护支持三种方式：<br>1、Basic<br>2、Digest<br>3、NTLM<br>–auth-cred用于给出身份认证的凭证，格式是“username:password”。</p>
<blockquote>
<p>python sqlmap.py -u “<a href="http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot;" target="_blank" rel="noopener">http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot;</a> –auth-type Basic –auth-cred “testuser:testpass”</p>
</blockquote>
<h3 id="参数：–proxy-–proxy-cred和–ignore-proxy"><a href="#参数：–proxy-–proxy-cred和–ignore-proxy" class="headerlink" title="参数：–proxy,–proxy-cred和–ignore-proxy"></a>参数：–proxy,–proxy-cred和–ignore-proxy</h3><p>使用–proxy代理是格式为：<a href="http://url:port。" target="_blank" rel="noopener">http://url:port。</a><br>当HTTP(S)代理需要认证是可以使用–proxy-cred参数：username:password。<br>–ignore-proxy拒绝使用本地局域网的HTTP(S)代理</p>
<p>参数：–auth-cert<br>Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。<br>key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件</p>
<h3 id="参数：–ignore-401"><a href="#参数：–ignore-401" class="headerlink" title="参数：–ignore-401"></a>参数：–ignore-401</h3><p>使用该参数忽略 401 错误（未认证</p>
<h3 id="参数：–tor、–tor-type、–tor-port-和–check-tor"><a href="#参数：–tor、–tor-type、–tor-port-和–check-tor" class="headerlink" title="参数：–tor、–tor-type、–tor-port 和–check-tor"></a>参数：–tor、–tor-type、–tor-port 和–check-tor</h3><p>安装类似 Privoxy 这样的软件按照Tor 的安装指导配置一个 Tor 客户端。设置好后使用参数“–tor”让 Sqlmap 自动设置使用 Tor 代理<br>如果想要手动指定 Tor 的类型和端口可以使用参数“–tor-type”和“–tor-port”<br>如果要求高度的匿名性可以使用参数“–check-tor”，加上该参数后 Sqlmap 会确保所有流量都走 Tor 代理，若 Tor 代理失效，Sqlmap 会发出警告并退出。检测方法是访问Are you using Tor?</p>
<h3 id="参数：–force-ssl"><a href="#参数：–force-ssl" class="headerlink" title="参数：–force-ssl"></a>参数：–force-ssl</h3><p>强制使用 SSL</p>
<h2 id="Optimization（优化"><a href="#Optimization（优化" class="headerlink" title="Optimization（优化)"></a>Optimization（优化)</h2><p>可用于优化SqlMap的性能</p>
<h3 id="参数：-o"><a href="#参数：-o" class="headerlink" title="参数：-o"></a>参数：-o</h3><p>开启所有优化开关,添加此参数相当于同时添加下列三个优化参数：<br>–keep-alive<br>–null-connection<br>–threads=3 </p>
<h3 id="参数：–keep-alive"><a href="#参数：–keep-alive" class="headerlink" title="参数：–keep-alive"></a>参数：–keep-alive</h3><p>该参数让 Sqlmap 使用 HTTP 长连接。该参数与“–proxy”矛盾</p>
<h3 id="参数：–null-connection"><a href="#参数：–null-connection" class="headerlink" title="参数：–null-connection"></a>参数：–null-connection</h3><p>有一种特殊的 HTTP 请求类型可以直接获得 HTTP 响应的大小而不用获得 HTTP 响应体。显然这在布尔型盲注中可以节约很大的带宽。当然这一技术是需要服务器端支持的。该参数与“–text-only”矛盾。</p>
<h3 id="参数：–threads"><a href="#参数：–threads" class="headerlink" title="参数：–threads"></a>参数：–threads</h3><p>使用该参数指定 Sqlmap 可以达到的最大并发数。从性能和网站承受能力两方面考虑最大并发数不要超过 10(默认1)</p>
<h2 id="Injection（注入）"><a href="#Injection（注入）" class="headerlink" title="Injection（注入）"></a>Injection（注入）</h2><h3 id="参数：-p-和–skip"><a href="#参数：-p-和–skip" class="headerlink" title="参数：-p 和–skip"></a>参数：-p 和–skip</h3><p>默认情况下 Sqlmap 会测试所有 GET 参数和 POST 参数，当 level 大于等于 2 时会测试 cookie 参数，当 level 大于等于 3 时会测试 User-Agent 和 Referer。实际上还可以手动指定一个以逗号分隔的、要测试的参数列表，该列表中的参数不受 level 限制。这就是“-p”的作用。<br>但是你可以手动用-p参数设置想要测试的参数。<br>例如： -p “id,user-anget”<br>当你使用–level的值很大但是有个别参数不想测试的时候可以使用–skip参数<br>例如：–skip=”user-angent.referer”<br>有时会遇到伪静态网页。像动态网页会明目张胆地列出参数，如：</p>
<blockquote>
<p>/user.php?id=1</p>
</blockquote>
<p>显然参数是 id，值为 1。但若是伪静态网页则可能这样写：</p>
<blockquote>
<p>/user/1/</p>
</blockquote>
<p>将参数隐藏在 URL 中。通常情况下 Sqlmap 不会对这样的伪静态网页的参数做测试，因为 Sqlmap 无法判断哪个是参数。若想要对这样的伪静态进行测试，只需要加上“*”，告诉 Sqlmap 哪个是伪静态参数就行，剩下事的和 GET 参数没有什么区别。如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap<span class="selector-class">.py</span> -u <span class="string">"http(s)://target.cc/user/1*/"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="参数：–dbms"><a href="#参数：–dbms" class="headerlink" title="参数：–dbms"></a>参数：–dbms</h3><p>默认情况系sqlmap会自动的探测web应用后端的数据库是什么，sqlmap支持的数据库有</p>
<ul>
<li>MySQL、</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server</li>
<li>Microsoft Access</li>
<li>SQLite</li>
<li>Firebird</li>
<li>Sybase</li>
<li>SAP MaxDB</li>
<li>DB2</li>
</ul>
<p>对于 Mysql 和 Microsoft SQL Server 和要这样指定：</p>
<ul>
<li>–dbms MySQL <version></version></li>
<li>–dbms Microsoft SQL Server <version></version></li>
</ul>
<p>对于 MySQL 来说，是类似这样的：5.0。对于 Microsoft SQL Server 来说，是类似这样的：2005。<br>如果在添加“–dbms”参数的同时还添加了“–fingerprint”，Sqlmap 只会在指定的数据库管理系统内进行指纹识别。<br>只有在很确定时使用“–dbms”，否则还是让 Sqlmap 自动检测更好些</p>
<h3 id="参数：–os"><a href="#参数：–os" class="headerlink" title="参数：–os"></a>参数：–os</h3><p>默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：</p>
<ul>
<li>Linux</li>
<li>Windows</li>
</ul>
<h3 id="参数：–invalid-bignum"><a href="#参数：–invalid-bignum" class="headerlink" title="参数：–invalid-bignum"></a>参数：–invalid-bignum</h3><p>当你想指定一个报错的数值时，可以使用这个参数，例如默认情况系id=13，sqlmap会变成id=-13来报错，你可以指定比如id=9999999来报错</p>
<h3 id="参数：–invalid-logical"><a href="#参数：–invalid-logical" class="headerlink" title="参数：–invalid-logical"></a>参数：–invalid-logical</h3><p>原因同上，可以指定id=13把原来的id=-13的报错改成id=13 AND 18=19</p>
<h3 id="参数：–prefix-–suffix"><a href="#参数：–prefix-–suffix" class="headerlink" title="参数：–prefix,–suffix"></a>参数：–prefix,–suffix</h3><p>需要在注入的payload的前面或者后面加一些字符，来保证payload的正常执行<br>代码中是这样调用数据库的:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query = "<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=(’<span class="string">" . $_GET[’id’] . "</span>’) <span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure></p>
<p>这时你就需要–prefix和–suffix参数了<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap<span class="selector-class">.py</span> -u <span class="string">"http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1"</span> -<span class="selector-tag">p</span> id --prefix <span class="string">"’)"</span> --suffix <span class="string">"AND (’abc’=’abc"</span></span><br></pre></td></tr></table></figure></p>
<p>这样执行的SQL语句变成：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query = "<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=(’<span class="number">1</span>’) &lt;PAYLOAD&gt; <span class="keyword">AND</span> (’abc’=’abc’) <span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure></p>
<h3 id="参数：–tamper"><a href="#参数：–tamper" class="headerlink" title="参数：–tamper"></a>参数：–tamper</h3><p>sqlmap除了使用CHAR()函数来防止出现单引号之外没有对注入的数据修改，你可以使用–tamper参数对数据做修改来绕过WAF等设备。<br>若该 tamper 脚本位于 sqlmap 的安装目录的 tamper/目录中，就可以省略路径和后缀名，只写文件名。<br>多个 tamper 脚本之间用空格隔开<br>在 tamper/目录中有许多可用的 tamper 脚本。tamper 脚本的作用是对 payload 进行混淆。<br>我们还可以自己写 tamper 脚本，这属于 Sqlmap 的高级用法，一个有效的 tamper 脚本如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 必须要导入的库</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="comment"># 定义该 tamper 脚本的优先级</span></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload)</span>:</span></span><br><span class="line">    <span class="string">'''此处是 tamper 的说明'''</span></span><br><span class="line">    retVal = payload</span><br><span class="line">    <span class="comment"># 此处是用于修改 payload 的代码</span></span><br><span class="line">    <span class="comment"># 返回修改后的 payload</span></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure></p>
<h3 id="参数：–no-escape"><a href="#参数：–no-escape" class="headerlink" title="参数：–no-escape"></a>参数：–no-escape</h3><p>有时 Sqlmap 会使用用单引号括起来的字符串值作为 payload，如“SELECT ‘foobar’”，默认地这些值会被编码，如上例将被编码为：<br>SELECT CHAR(102)+CHAR(111)+CHAR(111)+CHAR(98)+CHAR(97)+CHAR(114)) 这样做既可以混淆视听让人一时难以洞察 payload 的内容又可以在后台服务器使用类似 magic_quote 或 mysql_real_escape_string 这样的转义函数的情况下字符串不受影响。当然在某些情况下需要关闭字符串编码，如为了缩减 payload 长度，用户可以使用“–no-escape”来关闭字符串编码。</p>
<h2 id="Detection（检测）"><a href="#Detection（检测）" class="headerlink" title="Detection（检测）"></a>Detection（检测）</h2><p>可以用来指定在SQL盲注时如何解析和比较HTTP响应页面的内容<br>参数：–level<br>共有五个等级，默认为1，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload<br>这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent/Referer头在level为3的时候就会测试</p>
<h3 id="参数：–risk"><a href="#参数：–risk" class="headerlink" title="参数：–risk"></a>参数：–risk</h3><p>此参数用于指定风险等级，有 1~4 共 4 级。</p>
<ul>
<li>1会测试大部分的测试语句(默认)</li>
<li>2会增加基于事件的测试语句</li>
<li>3会增加OR语句的SQL注入测试。<br>在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险</li>
</ul>
<h3 id="参数：–string-–not-string-–regexp-–code"><a href="#参数：–string-–not-string-–regexp-–code" class="headerlink" title="参数：–string,–not-string,–regexp,–code"></a>参数：–string,–not-string,–regexp,–code</h3><p>页面比较：默认情况下sqlmap通过判断返回页面的不同来判断真假，但有时候这会产生误差，因为有的页面在每次刷新的时候都会返回不同的代码，比如页面当中包含一个动态的广告或者其他内容，这会导致sqlmap的误判。此时用户可以提供一个字符串或者一段正则匹配，在原始页面与真条件下的页面都存在的字符串，而错误页面中不存在（使用–string参数添加字符串，–regexp添加正则），同时用户可以提供一段字符串在原始页面与真条件下的页面都不存在的字符串，而错误页面中存在的字符串（–not-string添加）。用户也可以提供真与假条件返回的HTTP状态码不一样来注入，<br>例如，响应200的时候为真，响应401的时候为假，可以添加参数–code=200</p>
<h3 id="参数：–text-only-–titles"><a href="#参数：–text-only-–titles" class="headerlink" title="参数：–text-only,–titles"></a>参数：–text-only,–titles</h3><p>若是用户知道代表 True 的页面 title 和代表 False 的页面 title 不同，<br>如代表 True 的页面 title 为“Welcome”，代表 False 的页面 title 为“Forbidden”，<br>–titles”让 Sqlmap 依据 title 来判断 True 或 False<br>若是 HTTP 响应体中有许多诸如 JavaScript 之类的活动内容，可以使用–text-only让 Sqlmap 只专注于纯文本内容</p>
<h2 id="Techniques（技巧）"><a href="#Techniques（技巧）" class="headerlink" title="Techniques（技巧）"></a>Techniques（技巧）</h2><p>这些选项可用于调整具体的SQL注入测试。<br>B：Boolean-based blind（布尔型注入）<br>E：Error-based（报错型注入）<br>U：Union query-based（可联合查询注入）<br>S：Stacked queries（可多语句查询注入）<br>T：Time-based blind（基于时间延迟注入）<br>Q：Inline queries（嵌套查询注入）<br>可以用“–technique ES”来指定使用两种检测技术。“–technique BEUSTQ”与默认情况等效</p>
<h2 id="Fingerprint（指纹）："><a href="#Fingerprint（指纹）：" class="headerlink" title="Fingerprint（指纹）："></a>Fingerprint（指纹）：</h2><h3 id="参数-f"><a href="#参数-f" class="headerlink" title="参数 -f"></a>参数 -f</h3><p>–fingerprint 执行检查广泛的DBMS版本指纹</p>
<h2 id="Enumeration（枚举）："><a href="#Enumeration（枚举）：" class="headerlink" title="Enumeration（枚举）："></a>Enumeration（枚举）：</h2><p>这些选项可以用来列举后端数据库管理系统的信息、表中的结构和数据。此外，您还可以运行您自己的SQL语句</p>
<h3 id="参数：-b"><a href="#参数：-b" class="headerlink" title="参数：-b"></a>参数：-b</h3><p>–banner 检索数据库管理系统的标识<br>大多数的现代数据库管理系统都有一个函数或是环境变量能够返回数据库管理系统的版本号和最后的补丁级别以及底层的操作系统信息。<br>通常这个函数是 version()、环境变量是@@version，当然要看目标数据库管理系统了。使用参数“-b”或“–banner”来列举数据库管理系统的这一信息</p>
<h3 id="–current-user"><a href="#–current-user" class="headerlink" title="–current-user"></a>–current-user</h3><p>检索数据库管理系统当前用户</p>
<h3 id="–current-db"><a href="#–current-db" class="headerlink" title="–current-db"></a>–current-db</h3><p>检索数据库管理系统当前数据库</p>
<h3 id="–is-dba"><a href="#–is-dba" class="headerlink" title="–is-dba"></a>–is-dba</h3><p>检测DBMS当前用户是否DBA</p>
<h3 id="–users"><a href="#–users" class="headerlink" title="–users"></a>–users</h3><p>枚举数据库管理系统用户</p>
<h3 id="–passwords"><a href="#–passwords" class="headerlink" title="–passwords"></a>–passwords</h3><p>枚举数据库管理系统用户密码哈希</p>
<h3 id="–privileges"><a href="#–privileges" class="headerlink" title="–privileges"></a>–privileges</h3><p>枚举数据库管理系统用户的权限<br>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的权限。通过用户权限可以判断哪些用户是管理员。<br><img src="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418042800199.png" alt><br>若想只枚举特定用户的权限使用参数“-U”指定用户，可用“CU”来代表当前用户。<br>若目标是微软的 SQL Server，这一参数会列出每个用户是否是管理员而不列出每个用户的具体权限。</p>
<h3 id="–roles"><a href="#–roles" class="headerlink" title="–roles"></a>–roles</h3><p>枚举数据库管理系统用户的角色<br>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的角色。<br>若想只枚举特定用户的角色使用参数“-U”指定用户，可用“CU”来代表当前用户。<br>官方手册上说只有目标数据库管理系统是 Oracle 时这一功能才可用，但我在 Mysql 中测试也是可用的</p>
<h3 id="–dbs"><a href="#–dbs" class="headerlink" title="–dbs"></a>–dbs</h3><p>枚举数据库管理系统数据库<br>当前用户有读取包含了数据库管理系统中可用数据库信息的系统表的权限时使用这一参数可以列举数据库管理系统中所有数据库<br><img src="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043044906.png" alt></p>
<h3 id="–tables"><a href="#–tables" class="headerlink" title="–tables"></a>–tables</h3><p>枚举的DBMS数据库中的表<br>没有用参数“-D”指定数据库，只使用参数“–tables”会列举所有数据库中所有表<br>使用参数“–exclude-sysdbs”可排除系统数据库。在 Oracle 中要指定 TABLESPACE_NAME 而不是数据库名<br><img src="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043222137.png" alt></p>
<h3 id="–columns"><a href="#–columns" class="headerlink" title="–columns"></a>–columns</h3><p>枚举DBMS数据库表列<br><img src="http://picture.manhao6.cn/sql注入与sqlmap实践/20190418043600565.png" alt></p>
<h3 id="–dump"><a href="#–dump" class="headerlink" title="–dump"></a>–dump</h3><p>-C、-T、-D、–start、–stop 和–where<br>权限允许时可以列举表中数据。用参数“-D”指定数据库，用参数“-T”指定数据表，用参数“-C”指定目标列。<br>若只指定了数据表而没有指定数据库则默认使用当前数据库，若没有指定列则列举表中全部列。<br>数据保存到 CSV 格式文件中，文件具体路径会在 Sqlmap 的输出中给出</p>
<h3 id="–dump-all"><a href="#–dump-all" class="headerlink" title="–dump-all"></a>–dump-all</h3><p>使用参数“–dump-all”可列举所有数据库所有表中所有数据。同样地，可使用参数“–exclude-sysdbs”排除系统数据库。</p>
<ul>
<li>注意微软 SQL Server 的 master 数据库不属于系统数据库，因为有些管理员会在这个数据库中存储用户数据<h3 id="–search"><a href="#–search" class="headerlink" title="–search"></a>–search</h3>搜索列（S），表（S）和/或数据库名称（S）<h3 id="D-DB"><a href="#D-DB" class="headerlink" title="-D DB"></a>-D DB</h3>要进行枚举的数据库名<h3 id="T-TBL"><a href="#T-TBL" class="headerlink" title="-T TBL"></a>-T TBL</h3>要进行枚举的数据库表<h3 id="C-COL"><a href="#C-COL" class="headerlink" title="-C COL"></a>-C COL</h3>要进行枚举的数据库列<h3 id="U-USER"><a href="#U-USER" class="headerlink" title="-U USER"></a>-U USER</h3>用来进行枚举的数据库用户<h3 id="–exclude-sysdbs"><a href="#–exclude-sysdbs" class="headerlink" title="–exclude-sysdbs"></a>–exclude-sysdbs</h3>枚举表时排除系统数据库<h3 id="–start-LIMITSTART"><a href="#–start-LIMITSTART" class="headerlink" title="–start=LIMITSTART"></a>–start=LIMITSTART</h3>第一个查询输出进入检索<h3 id="–stop-LIMITSTOP"><a href="#–stop-LIMITSTOP" class="headerlink" title="–stop=LIMITSTOP"></a>–stop=LIMITSTOP</h3>最后查询的输出进入检索<h3 id="–first-FIRSTCHAR"><a href="#–first-FIRSTCHAR" class="headerlink" title="–first=FIRSTCHAR"></a>–first=FIRSTCHAR</h3>第一个查询输出字的字符检索<h3 id="–last-LASTCHAR"><a href="#–last-LASTCHAR" class="headerlink" title="–last=LASTCHAR"></a>–last=LASTCHAR</h3>最后查询的输出字字符检索<h3 id="–sql-query-QUERY"><a href="#–sql-query-QUERY" class="headerlink" title="–sql-query=QUERY"></a>–sql-query=QUERY</h3>要执行的SQL语句<h3 id="–sql-shell"><a href="#–sql-shell" class="headerlink" title="–sql-shell"></a>–sql-shell</h3>提示交互式SQL的shell</li>
</ul>
<p>##Brute force（蛮力）：<br>这些选项可以被用来运行蛮力检查。</p>
<h3 id="–common-tables-检查存在共同表"><a href="#–common-tables-检查存在共同表" class="headerlink" title="–common-tables 检查存在共同表"></a>–common-tables 检查存在共同表</h3><h3 id="–common-columns-检查存在共同列"><a href="#–common-columns-检查存在共同列" class="headerlink" title="–common-columns 检查存在共同列"></a>–common-columns 检查存在共同列</h3><h2 id="User-defined-function-injection（用户自定义函数注入）："><a href="#User-defined-function-injection（用户自定义函数注入）：" class="headerlink" title="User-defined function injection（用户自定义函数注入）："></a>User-defined function injection（用户自定义函数注入）：</h2><p>这些选项可以用来创建用户自定义函数。</p>
<h3 id="–udf-inject-注入用户自定义函数"><a href="#–udf-inject-注入用户自定义函数" class="headerlink" title="–udf-inject 注入用户自定义函数"></a>–udf-inject 注入用户自定义函数</h3><h3 id="–shared-lib-SHLIB-共享库的本地路径"><a href="#–shared-lib-SHLIB-共享库的本地路径" class="headerlink" title="–shared-lib=SHLIB 共享库的本地路径"></a>–shared-lib=SHLIB 共享库的本地路径</h3><h2 id="File-system-access（访问文件系统）："><a href="#File-system-access（访问文件系统）：" class="headerlink" title="File system access（访问文件系统）："></a>File system access（访问文件系统）：</h2><p>这些选项可以被用来访问后端数据库管理系统的底层文件系统。</p>
<h3 id="–file-read-RFILE"><a href="#–file-read-RFILE" class="headerlink" title="–file-read=RFILE"></a>–file-read=RFILE</h3><p>从后端的数据库管理系统文件系统读取文件<br>当数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有读取文件相关权限时读取文件是可行的</p>
<h3 id="–file-write-WFILE-–file-dest-DFILE"><a href="#–file-write-WFILE-–file-dest-DFILE" class="headerlink" title="–file-write=WFILE   –file-dest=DFILE"></a>–file-write=WFILE   –file-dest=DFILE</h3><p>file-write编辑后端的数据库管理系统文件系统上的本地文件<br>file-dest后端的数据库管理系统写入文件的绝对路径<br>当数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有写文件相关权限时上传文件是可行的。<br>上传的文件既可以是文件文件也可以是二进制文件.</p>
<p>### </p>
<h2 id="Operating-system-access（操作系统访问）："><a href="#Operating-system-access（操作系统访问）：" class="headerlink" title="Operating system access（操作系统访问）："></a>Operating system access（操作系统访问）：</h2><p>这些选项可以用于访问后端数据库管理系统的底层操作系统。</p>
<h3 id="–os-cmd-OSCMD-–os-shell"><a href="#–os-cmd-OSCMD-–os-shell" class="headerlink" title="–os-cmd=OSCMD  –os-shell"></a>–os-cmd=OSCMD  –os-shell</h3><p>执行操作系统命令(若数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有相关权限 Sqlmap 就能利用 SQL 注入执行任意的操作系统命令)<br>当数据库管理系统是 MySQL 或 PostgreSQL 时，Sqlmap 会通过前面介绍过的文件上传功能上传一个包含用户自定义函数 sys_exec()和 sys_eval()的二进制共享库文件，然后创建这两个用户自定义函数，通过这两个函数之一来执行用户指定的命令。选择哪个函数取决于用户是否想要显示命令执行的标准输出<br>当数据库管理系统是微软的 SQL Server 时，Sqlmap 通过存储过程 xp_cmdshell 来执行任意命令。<br>若 xp_cmdshell 被禁用（SQL Server &gt;= 2005 时默认禁用）Sqlmap 会启用它；<br>若 xp_cmdshell 不存在，Sqlmap 会创建它。</p>
<p>当用户想要看到命令执行的标准输出时，Sqlmap 使用可列举的注入技术（盲注、带内和基于错误的注入），而当用户不想看到命令执行的标准输出时，堆查询注入技术将被用于执行命令</p>
<h3 id="–os-pwn-–os-bof-–os-smbrelay"><a href="#–os-pwn-–os-bof-–os-smbrelay" class="headerlink" title="–os-pwn –os-bof  –os-smbrelay"></a>–os-pwn –os-bof  –os-smbrelay</h3><p>os-pwn获取一个OOB shell，meterpreter或VNC<br>os-bof一键获取一个OOB shell，meterpreter或VNC<br>os-smbrelay存储过程缓冲区溢出利用</p>
<h3 id="–priv-esc"><a href="#–priv-esc" class="headerlink" title="–priv-esc"></a>–priv-esc</h3><p>数据库进程用户权限提升</p>
<h3 id="–msf-path-MSFPATH"><a href="#–msf-path-MSFPATH" class="headerlink" title="–msf-path=MSFPATH"></a>–msf-path=MSFPATH</h3><p>Metasploit Framework本地的安装路径</p>
<h3 id="–tmp-path-TMPPATH"><a href="#–tmp-path-TMPPATH" class="headerlink" title="–tmp-path=TMPPATH"></a>–tmp-path=TMPPATH</h3><p>远程临时文件目录的绝对路径<br>若数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有相关权限 Sqlmap 就有可能在攻击者的主机和数据库所在主机之间建立带外 TCP 连接。根据用户的选择，此连接可以是交互式命令 shell，Meterpreter 会话或图形用户界面（VNC）会话。</p>
<p>Sqlmap 要靠 Metasploit 生成 shellcode，在数据库所在主机执行 shellcode 有以下四种技术：</p>
<p>数据库通过 Sqlmap 创建的用户自定义函数 sys_bineval()在内存中执行 Metasploit 的 shellcode。支持 MySQL 和 PostgreSQL。参数“–os-pwn”。<br>通过 Sqlmap 自己的用户自定义函数（MySQL 和 PostgreSQL 中的 sys_exec()，微软 SQL Server 中的 xp_cmdshell()）上传并执行 Metasploit 的“stand-alone payload stager”。参数：“–os-pwn”。<br>利用远程代码执行漏洞MS08-068。攻击者的机器要用 Metasploit 的 smb_relay 监听来自目标机器的连接。要求在 Linux/Unix 上以 root 权限运行 Sqlmap 且目标 DBMS 在 Windows 上以管理员权限运行。参数：“–os-smbrelay”。<br>在微软 SQL Server 2000 和 2005 中可通过存储过程 sp_replwritetovarbin 的堆缓冲区溢出漏洞（MS09-004）在内存中执行 Metasploit 的 shellcode。Sqlmap 有自己的数据执行保护绕过技术可以成功利用漏洞，但需要 Metasploit 生成 shellcode 以便在成功利用漏洞时执行 shellcode。参数：“–os-bof</p>
<h2 id="Windows注册表访问："><a href="#Windows注册表访问：" class="headerlink" title="Windows注册表访问："></a>Windows注册表访问：</h2><p>这些选项可以被用来访问后端数据库管理系统Windows注册表。</p>
<p>–reg-read 读一个Windows注册表项值<br>–reg-add 写一个Windows注册表项值数据<br>–reg-del 删除Windows注册表键值<br>–reg-key=REGKEY Windows注册表键<br>–reg-value=REGVAL Windows注册表项值<br>–reg-data=REGDATA Windows注册表键值数据<br>–reg-type=REGTYPE Windows注册表项值类型</p>
<h2 id="General（一般）："><a href="#General（一般）：" class="headerlink" title="General（一般）："></a>General（一般）：</h2><p>这些选项可以用来设置一些一般的工作参数。<br>sqlite会话文件保存位置</p>
<ul>
<li>-s SESSIONFILE      Load session from a stored (.sqlite) file  </li>
</ul>
<p>记录流量文件保存文件</p>
<ul>
<li>-t TRAFFICFILE      Log all HTTP traffic into a textual file  </li>
</ul>
<p>永远不要求用户输入，使用默认行为</p>
<ul>
<li>–batch             Never ask for user input, use the default behavior  </li>
</ul>
<p>具有二进制值的结果字段</p>
<ul>
<li>–binary-fields=..  Result fields having binary values (e.g. “digest”)  </li>
</ul>
<p>在评估目标之前检查Internet连接</p>
<ul>
<li>–check-internet    Check Internet connection before assessing the target  </li>
</ul>
<p>从目标网址开始抓取网站</p>
<ul>
<li>–crawl=CRAWLDEPTH  Crawl the website starting from the target URL  </li>
</ul>
<p>正则表达式从抓取中排除页面（例如“logout”）</p>
<ul>
<li>–crawl-exclude=..  Regexp to exclude pages from crawling (e.g. “logout”)  </li>
</ul>
<p>分隔CSV输出中使用的字符（默认为“，”）</p>
<ul>
<li>–csv-del=CSVDEL    Delimiting character used in CSV output (default “,”)  </li>
</ul>
<p>盲SQL注入字符集（例如“0123456789abcdef”）</p>
<ul>
<li>–charset=CHARSET   Blind SQL injection charset (e.g. “0123456789abcdef”)  </li>
</ul>
<p>转储数据的格式（CSV（默认），HTML或SQLITE）</p>
<ul>
<li>–dump-format=DU..  Format of dumped data (CSV (default), HTML or SQLITE)  </li>
</ul>
<p>用于数据检索的字符编码（例如GBK）</p>
<ul>
<li>–encoding=ENCOD..  Character encoding used for data retrieval (e.g. GBK)  </li>
</ul>
<p>显示每个输出的预计到达时间</p>
<ul>
<li>–eta               Display for each output the estimated time of arrival  </li>
</ul>
<p>刷新当前目标的会话文件</p>
<ul>
<li>–flush-session     Flush session files for current target  </li>
</ul>
<p>在目标URL上解析和测试表单</p>
<ul>
<li>–forms             Parse and test forms on target URL  </li>
</ul>
<p>忽略存储在会话文件中的查询结果,重新进行数据查询</p>
<ul>
<li>–fresh-queries     Ignore query results stored in session file  </li>
</ul>
<p>将所有HTTP流量记录到HAR文件中</p>
<ul>
<li>–har=HARFILE       Log all HTTP traffic into a HAR file  </li>
</ul>
<p>在数据检索期间使用十六进制转,检索结束后会转换回原来数据格式.</p>
<ul>
<li>–hex               Use hex conversion during data retrieval  </li>
</ul>
<p>自定义输出目录路径</p>
<ul>
<li>–output-dir=OUT..  Custom output directory path  </li>
</ul>
<p>分析和实现数据库内建报错信息</p>
<ul>
<li>–parse-errors      Parse and display DBMS error messages from responses  </li>
</ul>
<p>将命令保存成配置文件</p>
<ul>
<li>–save=SAVECONFIG   Save options to a configuration INI file  </li>
</ul>
<p>正则表达式从提供的代理日志中过滤目标</p>
<ul>
<li>–scope=SCOPE       Regexp to filter targets from provided proxy log  </li>
</ul>
<p>若只想使用包含关键词“ROW”的payload可使用参数“–test-filter=ROW”</p>
<ul>
<li>–test-filter=TE..  Select tests by payloads and/or titles (e.g. ROW)  </li>
</ul>
<p>若不想使用包含关键词“BENCHMARK”的payload可使用参数“–test-skip=BENCHMARK”</p>
<ul>
<li>–test-skip=TEST..  Skip tests by payloads and/or titles (e.g. BENCHMARK)  </li>
</ul>
<p>更新sqlmap</p>
<ul>
<li>–update            Update sqlmap</li>
</ul>
<h2 id="Miscellaneous（杂项）："><a href="#Miscellaneous（杂项）：" class="headerlink" title="Miscellaneous（杂项）："></a>Miscellaneous（杂项）：</h2><p>使用短助记符（例如“flu，bat，ban，tec = EU”）</p>
<ul>
<li>-z MNEMONICS        Use short mnemonics (e.g. “flu,bat,ban,tec=EU”)  </li>
</ul>
<p>在找到SQL注入时运行主机OS命令</p>
<ul>
<li>–alert=ALERT       Run host OS command(s) when SQL injection is found  </li>
</ul>
<p>设置预定义答案（例如“quit = N，follow = N”）</p>
<ul>
<li>–answers=ANSWERS   Set predefined answers (e.g. “quit=N,follow=N”)  </li>
</ul>
<p>当发现SQL注入时,发出问题提示音</p>
<ul>
<li>–beep              Beep on question and/or when SQL injection is found  </li>
</ul>
<p>清除sqlmap注入时产生的udf与表</p>
<ul>
<li>–cleanup           Clean up the DBMS from sqlmap specific UDF and tables  </li>
</ul>
<p>检查缺少（可选）sqlmap依赖项</p>
<ul>
<li>–dependencies      Check for missing (optional) sqlmap dependencies  </li>
</ul>
<p>sqlmap默认彩色输出，可以使用此参数，禁掉彩色输出</p>
<ul>
<li>–disable-coloring  Disable console output coloring  </li>
</ul>
<p>使用指定的Google结果页面</p>
<ul>
<li>–gpage=GOOGLEPAGE  Use Google dork results from specified page number  </li>
</ul>
<p>对WAF / IPS保护进行全面测试</p>
<ul>
<li>–identify-waf      Make a thorough testing for a WAF/IPS protection  </li>
</ul>
<p>显示可用篡改脚本的列表</p>
<ul>
<li>–list-tampers      Display list of available tamper scripts  </li>
</ul>
<p>通过HTTP User-Agent标头模拟智能手机</p>
<ul>
<li>–mobile            Imitate smartphone through HTTP User-Agent header  </li>
</ul>
<p>在离线模式下工作（仅使用会话数据）</p>
<ul>
<li>–offline           Work in offline mode (only use session data)  </li>
</ul>
<p>安全地从sqlmap数据目录中删除所有内容</p>
<ul>
<li>–purge             Safely remove all content from sqlmap data directory  </li>
</ul>
<p>跳过WAF / IPS保护的启发式检测</p>
<ul>
<li>–skip-waf          Skip heuristic detection of WAF/IPS protection  </li>
</ul>
<p>有时对目标非常多的URL进行测试，为节省时间，只对能够快速判断为注入的报错点进行注入，可以使用此参数。</p>
<ul>
<li>–smart             Conduct thorough tests only if positive heuristic(s)  </li>
</ul>
<p>提示交互式sqlmap shell</p>
<ul>
<li>–sqlmap-shell      Prompt for an interactive sqlmap shell  </li>
</ul>
<p>用于存储临时文件的本地目录</p>
<ul>
<li>–tmp-dir=TMPDIR    Local directory for storing temporary files  </li>
</ul>
<p>Web服务器文档根目录（例如“/ var / www”），当没指定目录的情况下</p>
<ul>
<li>–web-root=WEBROOT  Web server document root directory (e.g. “/var/www”)  </li>
</ul>
<p>简单的向导界面，适合初学者用户</p>
<ul>
<li>–wizard            Simple wizard interface for beginner users</li>
</ul>

      
    </div>

    

    
    
    
    
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/04/06/sql注入与sqlmap实践/">sqlmap使用手册</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Tea_Mh 的个人博客">Tea_Mh</a></p>
  <p><span>发布时间:</span>2019年04月06日 - 16:43</p>
  <p><span>最后更新:</span>2019年05月25日 - 02:00</p>
  <p><span>原始链接:</span><a href="/2019/04/06/sql注入与sqlmap实践/" title="sqlmap使用手册">blog.manhao6.cn/2019/04/06/sql注入与sqlmap实践/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="blog.manhao6.cn/2019/04/06/sql注入与sqlmap实践/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
	});
    });  
</script>

      
   
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
  <img id="wechat_subscriber_qcode" src="http://picture.manhao6.cn/20190220135756363/20190220015831441.png" alt="Tea_Mh wechat" style="width: 200px; max-width: 100%;">
  <div>欢迎加我微信，交流交流</div>
</div>

      

    
      
    
    

    
    <div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------　　　　本文结束　<i class="fa fa-heart"></i>　感谢您的阅读　　　　-------------</div>
    
</div>
  
</div>
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/sqlmap/" rel="tag"># sqlmap</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/16/记一次thinkphp上传漏洞（白盒审计）/" rel="next" title="记一次thinkphp上传漏洞">
                <i class="fa fa-chevron-left"></i> 记一次thinkphp上传漏洞
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80Mjc2Mi8xOTMwOQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://upload-images.jianshu.io/upload_images/8707100-c1b6a69a8bfcd8c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/957/format/webp" alt="Tea_Mh">
            
              <p class="site-author-name" itemprop="name">Tea_Mh</p>
              <p class="site-description motion-element" itemprop="description">兜兜的熊猫</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/分类/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/标签/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/teazmh" title="GitHub &rarr; https://github.com/teazmh" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:man19951124@gmail.com" title="E-Mail &rarr; mailto:man19951124@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/2315663684" title="微博 &rarr; https://weibo.com/2315663684" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>微博</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="tencent://message/?uin=1130830188" title="QQ &rarr; tencent://message/?uin=1130830188" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://rliyuqing.github.io/" title="https://rliyuqing.github.io/" rel="noopener" target="_blank">嵩嵩</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://luckyjq.github.io/" title="https://luckyjq.github.io/" rel="noopener" target="_blank">luckyjq</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://zheng19970225.github.io/" title="https://zheng19970225.github.io/" rel="noopener" target="_blank">让子弹飞一会</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-前言"><span class="nav-number">1.</span> <span class="nav-text">0x01 前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#工作模式"><span class="nav-number">1.1.</span> <span class="nav-text">工作模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特点"><span class="nav-number">1.2.</span> <span class="nav-text">特点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sqlmap使用"><span class="nav-number">2.</span> <span class="nav-text">sqlmap使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Target（目标）"><span class="nav-number">2.1.</span> <span class="nav-text">Target（目标）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-–url-u"><span class="nav-number">2.1.1.</span> <span class="nav-text">参数： –url -u</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-m-l"><span class="nav-number">2.1.2.</span> <span class="nav-text">参数： -m -l</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-d"><span class="nav-number">2.1.3.</span> <span class="nav-text">参数：-d</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-r"><span class="nav-number">2.1.4.</span> <span class="nav-text">参数： -r</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-g"><span class="nav-number">2.1.5.</span> <span class="nav-text">参数：-g</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-c"><span class="nav-number">2.1.6.</span> <span class="nav-text">参数：-c</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Request（请求）"><span class="nav-number">2.2.</span> <span class="nav-text">Request（请求）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–data-–param-del"><span class="nav-number">2.2.1.</span> <span class="nav-text">参数：–data,–param-del</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–cookie-–load-cookies-–drop-set-cookie-–cookie-del"><span class="nav-number">2.2.2.</span> <span class="nav-text">参数：–cookie,–load-cookies,–drop-set-cookie –cookie-del</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–user-agent-–random-agent"><span class="nav-number">2.2.3.</span> <span class="nav-text">参数：–user-agent,–random-agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–referer"><span class="nav-number">2.2.4.</span> <span class="nav-text">参数：–referer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–headers"><span class="nav-number">2.2.5.</span> <span class="nav-text">参数：–headers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–delay"><span class="nav-number">2.2.6.</span> <span class="nav-text">参数：–delay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–timeout"><span class="nav-number">2.2.7.</span> <span class="nav-text">参数：–timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–retries"><span class="nav-number">2.2.8.</span> <span class="nav-text">参数：–retries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–randomize"><span class="nav-number">2.2.9.</span> <span class="nav-text">参数：–randomize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–safe-url-–safe-post-–safe-freq-–safe-feq"><span class="nav-number">2.2.10.</span> <span class="nav-text">参数：–safe-url,–safe-post –safe-freq –safe-feq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–skip-urlencode"><span class="nav-number">2.2.11.</span> <span class="nav-text">参数：–skip-urlencode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–csrf-token-和–csrf-url"><span class="nav-number">2.2.12.</span> <span class="nav-text">参数：–csrf-token 和–csrf-url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–eval"><span class="nav-number">2.2.13.</span> <span class="nav-text">参数：–eval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–auth-type-–auth-cred"><span class="nav-number">2.2.14.</span> <span class="nav-text">参数：–auth-type,–auth-cred</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–proxy-–proxy-cred和–ignore-proxy"><span class="nav-number">2.2.15.</span> <span class="nav-text">参数：–proxy,–proxy-cred和–ignore-proxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–ignore-401"><span class="nav-number">2.2.16.</span> <span class="nav-text">参数：–ignore-401</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–tor、–tor-type、–tor-port-和–check-tor"><span class="nav-number">2.2.17.</span> <span class="nav-text">参数：–tor、–tor-type、–tor-port 和–check-tor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–force-ssl"><span class="nav-number">2.2.18.</span> <span class="nav-text">参数：–force-ssl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optimization（优化"><span class="nav-number">2.3.</span> <span class="nav-text">Optimization（优化)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-o"><span class="nav-number">2.3.1.</span> <span class="nav-text">参数：-o</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–keep-alive"><span class="nav-number">2.3.2.</span> <span class="nav-text">参数：–keep-alive</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–null-connection"><span class="nav-number">2.3.3.</span> <span class="nav-text">参数：–null-connection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–threads"><span class="nav-number">2.3.4.</span> <span class="nav-text">参数：–threads</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Injection（注入）"><span class="nav-number">2.4.</span> <span class="nav-text">Injection（注入）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-p-和–skip"><span class="nav-number">2.4.1.</span> <span class="nav-text">参数：-p 和–skip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–dbms"><span class="nav-number">2.4.2.</span> <span class="nav-text">参数：–dbms</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–os"><span class="nav-number">2.4.3.</span> <span class="nav-text">参数：–os</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–invalid-bignum"><span class="nav-number">2.4.4.</span> <span class="nav-text">参数：–invalid-bignum</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–invalid-logical"><span class="nav-number">2.4.5.</span> <span class="nav-text">参数：–invalid-logical</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–prefix-–suffix"><span class="nav-number">2.4.6.</span> <span class="nav-text">参数：–prefix,–suffix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–tamper"><span class="nav-number">2.4.7.</span> <span class="nav-text">参数：–tamper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–no-escape"><span class="nav-number">2.4.8.</span> <span class="nav-text">参数：–no-escape</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Detection（检测）"><span class="nav-number">2.5.</span> <span class="nav-text">Detection（检测）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–risk"><span class="nav-number">2.5.1.</span> <span class="nav-text">参数：–risk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–string-–not-string-–regexp-–code"><span class="nav-number">2.5.2.</span> <span class="nav-text">参数：–string,–not-string,–regexp,–code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：–text-only-–titles"><span class="nav-number">2.5.3.</span> <span class="nav-text">参数：–text-only,–titles</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Techniques（技巧）"><span class="nav-number">2.6.</span> <span class="nav-text">Techniques（技巧）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fingerprint（指纹）："><span class="nav-number">2.7.</span> <span class="nav-text">Fingerprint（指纹）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数-f"><span class="nav-number">2.7.1.</span> <span class="nav-text">参数 -f</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enumeration（枚举）："><span class="nav-number">2.8.</span> <span class="nav-text">Enumeration（枚举）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数：-b"><span class="nav-number">2.8.1.</span> <span class="nav-text">参数：-b</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–current-user"><span class="nav-number">2.8.2.</span> <span class="nav-text">–current-user</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–current-db"><span class="nav-number">2.8.3.</span> <span class="nav-text">–current-db</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–is-dba"><span class="nav-number">2.8.4.</span> <span class="nav-text">–is-dba</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–users"><span class="nav-number">2.8.5.</span> <span class="nav-text">–users</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–passwords"><span class="nav-number">2.8.6.</span> <span class="nav-text">–passwords</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–privileges"><span class="nav-number">2.8.7.</span> <span class="nav-text">–privileges</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–roles"><span class="nav-number">2.8.8.</span> <span class="nav-text">–roles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–dbs"><span class="nav-number">2.8.9.</span> <span class="nav-text">–dbs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–tables"><span class="nav-number">2.8.10.</span> <span class="nav-text">–tables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–columns"><span class="nav-number">2.8.11.</span> <span class="nav-text">–columns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–dump"><span class="nav-number">2.8.12.</span> <span class="nav-text">–dump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–dump-all"><span class="nav-number">2.8.13.</span> <span class="nav-text">–dump-all</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–search"><span class="nav-number">2.8.14.</span> <span class="nav-text">–search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#D-DB"><span class="nav-number">2.8.15.</span> <span class="nav-text">-D DB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#T-TBL"><span class="nav-number">2.8.16.</span> <span class="nav-text">-T TBL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-COL"><span class="nav-number">2.8.17.</span> <span class="nav-text">-C COL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#U-USER"><span class="nav-number">2.8.18.</span> <span class="nav-text">-U USER</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–exclude-sysdbs"><span class="nav-number">2.8.19.</span> <span class="nav-text">–exclude-sysdbs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–start-LIMITSTART"><span class="nav-number">2.8.20.</span> <span class="nav-text">–start=LIMITSTART</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–stop-LIMITSTOP"><span class="nav-number">2.8.21.</span> <span class="nav-text">–stop=LIMITSTOP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–first-FIRSTCHAR"><span class="nav-number">2.8.22.</span> <span class="nav-text">–first=FIRSTCHAR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–last-LASTCHAR"><span class="nav-number">2.8.23.</span> <span class="nav-text">–last=LASTCHAR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–sql-query-QUERY"><span class="nav-number">2.8.24.</span> <span class="nav-text">–sql-query=QUERY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–sql-shell"><span class="nav-number">2.8.25.</span> <span class="nav-text">–sql-shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–common-tables-检查存在共同表"><span class="nav-number">2.8.26.</span> <span class="nav-text">–common-tables 检查存在共同表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–common-columns-检查存在共同列"><span class="nav-number">2.8.27.</span> <span class="nav-text">–common-columns 检查存在共同列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#User-defined-function-injection（用户自定义函数注入）："><span class="nav-number">2.9.</span> <span class="nav-text">User-defined function injection（用户自定义函数注入）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#–udf-inject-注入用户自定义函数"><span class="nav-number">2.9.1.</span> <span class="nav-text">–udf-inject 注入用户自定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–shared-lib-SHLIB-共享库的本地路径"><span class="nav-number">2.9.2.</span> <span class="nav-text">–shared-lib=SHLIB 共享库的本地路径</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-system-access（访问文件系统）："><span class="nav-number">2.10.</span> <span class="nav-text">File system access（访问文件系统）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#–file-read-RFILE"><span class="nav-number">2.10.1.</span> <span class="nav-text">–file-read=RFILE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–file-write-WFILE-–file-dest-DFILE"><span class="nav-number">2.10.2.</span> <span class="nav-text">–file-write=WFILE   –file-dest=DFILE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Operating-system-access（操作系统访问）："><span class="nav-number">2.11.</span> <span class="nav-text">Operating system access（操作系统访问）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#–os-cmd-OSCMD-–os-shell"><span class="nav-number">2.11.1.</span> <span class="nav-text">–os-cmd=OSCMD  –os-shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–os-pwn-–os-bof-–os-smbrelay"><span class="nav-number">2.11.2.</span> <span class="nav-text">–os-pwn –os-bof  –os-smbrelay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–priv-esc"><span class="nav-number">2.11.3.</span> <span class="nav-text">–priv-esc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–msf-path-MSFPATH"><span class="nav-number">2.11.4.</span> <span class="nav-text">–msf-path=MSFPATH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#–tmp-path-TMPPATH"><span class="nav-number">2.11.5.</span> <span class="nav-text">–tmp-path=TMPPATH</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows注册表访问："><span class="nav-number">2.12.</span> <span class="nav-text">Windows注册表访问：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#General（一般）："><span class="nav-number">2.13.</span> <span class="nav-text">General（一般）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Miscellaneous（杂项）："><span class="nav-number">2.14.</span> <span class="nav-text">Miscellaneous（杂项）：</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">  <a href="http://www.miitbeian.gov.cn" rel="noopener" target="_blank">陕ICP备19003970号-1 </a>&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tea_Mh</span>

  

  
</div>
<span id="busuanzi_container_site_uv">
  本站总访问量<span id="busuanzi_value_site_uv"></span>次--------
</span>

  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div>



        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  
    <script>
  window.livereOptions = {
    refer: '2019/04/06/sql注入与sqlmap实践/'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=7.0.0"></script>



  

  

  
  

  
  

  


  
  

  
  

  


  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; 
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


</body>
</html>
